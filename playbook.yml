---

- name: config
  gather_facts: false
  hosts:
    - pi
    - localhost
  tags:
    - always
  tasks:
    - name: load config
      community.sops.load_vars:
        file: config.yml

- name: external
  gather_facts: false
  hosts: pi
  roles:
    - role: external
      tags: external

- name: setup
  gather_facts: false
  hosts: pi
  roles:
    - role: setup
      tags: setup

- name: deploy
  gather_facts: false
  hosts: pi
  roles:
    - role: datadog
      tags: datadog

    - role: light
      tags: light

    - role: vpn
      tags: vpn

    - role: docker_secrets
      tags:
        - docker_secrets
        - traefik

    - role: traefik
      tags: traefik

    - role: registry
      tags: registry

    - role: homepage
      tags: homepage

    - role: sync
      tags: sync

    - role: cloudflare
      tags: cloudflare

    - role: temporalite
      tags: temporalite

    - role: temporal_web
      tags: temporal_web
